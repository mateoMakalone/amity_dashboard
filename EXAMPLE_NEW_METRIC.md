# –ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –º–µ—Ç—Ä–∏–∫–∏

## üéØ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### –ó–∞–¥–∞—á–∞
–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –º–µ—Ç—Ä–∏–∫—É "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π" –≤ —Å–µ–∫—Ü–∏—é "KPI"

### –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± (4 –º–µ—Å—Ç–∞ –¥–ª—è –ø—Ä–∞–≤–∫–∏)

1. **–î–æ–±–∞–≤–∏—Ç—å –≤ SECTIONS**:
```python
SECTIONS = {
    "KPI": [
        "avg_response_time_api",
        "system_cpu_usage", 
        "jvm_memory_used",
        "postgres_connections",
        "postgres_locks",
        "gc_pause_time",
        "system_load",
        "tx_pool_size",
        "active_users"  # ‚Üê –î–æ–±–∞–≤–∏—Ç—å –∑–¥–µ—Å—å
    ],
    # ...
}
```

2. **–î–æ–±–∞–≤–∏—Ç—å –≤ ALL_METRICS**:
```python
ALL_METRICS = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ ...
    "active_users": {  # ‚Üê –î–æ–±–∞–≤–∏—Ç—å –∑–¥–µ—Å—å
        "label": "–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
        "promql": "active_users_total",
        "type": "trend",
        "unit": "",
        "color": "#e74c3c",
        "format": "fixed0"
    }
}
```

3. **–î–æ–±–∞–≤–∏—Ç—å –≤ KPI_METRIC_IDS**:
```python
KPI_METRIC_IDS = [
    "avg_response_time_api",
    "get_response_time",
    "post_response_time",
    "system_cpu_usage",
    "jvm_memory_used",
    "postgres_connections",
    "postgres_locks",
    "gc_pause_time",
    "system_load",
    "tx_pool_size",
    "active_users"  # ‚Üê –î–æ–±–∞–≤–∏—Ç—å –∑–¥–µ—Å—å
]
```

4. **–î–æ–±–∞–≤–∏—Ç—å –≤ INITIAL_METRICS**:
```python
INITIAL_METRICS = [
    'tx_pool_size',
    'jetty_server_requests_seconds_avg',
    # ... –º–Ω–æ–≥–æ –¥—Ä—É–≥–∏—Ö –º–µ—Ç—Ä–∏–∫ ...
    'active_users'  # ‚Üê –î–æ–±–∞–≤–∏—Ç—å –∑–¥–µ—Å—å
]
```

**–í—Ä–µ–º—è**: ~5 –º–∏–Ω—É—Ç
**–†–∏—Å–∫ –æ—à–∏–±–æ–∫**: –í—ã—Å–æ–∫–∏–π (–ª–µ–≥–∫–æ –∑–∞–±—ã—Ç—å –æ–¥–Ω–æ –∏–∑ –º–µ—Å—Ç)

---

### –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± (1 –º–µ—Å—Ç–æ –¥–ª—è –ø—Ä–∞–≤–∫–∏)

1. **–î–æ–±–∞–≤–∏—Ç—å –≤ METRICS_CONFIG**:
```python
METRICS_CONFIG = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ ...
    
    "active_users": {  # ‚Üê –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å
        "section": "KPI",
        "label": "–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
        "promql": "active_users_total",
        "type": "trend",
        "unit": "",
        "color": "#e74c3c",
        "format": "fixed0"
    }
}
```

**–í—Ä–µ–º—è**: ~30 —Å–µ–∫—É–Ω–¥
**–†–∏—Å–∫ –æ—à–∏–±–æ–∫**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (—Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –º–µ—Å—Ç–æ)

---

## ‚úÖ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫–∏ –≤ `METRICS_CONFIG` —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. **–°–æ–∑–¥–∞–µ—Ç —Å–µ–∫—Ü–∏—é** (–µ—Å–ª–∏ –µ—ë –Ω–µ—Ç)
2. **–î–æ–±–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫—É –≤ —Å–µ–∫—Ü–∏—é**
3. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞**
4. **–û–±–Ω–æ–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**
5. **–°–æ–∑–¥–∞–µ—Ç KPI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** (–µ—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∞ –≤ KPI —Å–µ–∫—Ü–∏–∏)

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –≤ –¥–∞—à–±–æ—Ä–¥–µ
- ‚úÖ –ë—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–µ–∫—Ü–∏–∏
- ‚úÖ –ì—Ä–∞—Ñ–∏–∫ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –Ω–æ–≤—É—é –º–µ—Ç—Ä–∏–∫—É

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Ä–æ–≥–∏
```python
"active_users": {
    "section": "KPI",
    "label": "–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
    "promql": "active_users_total",
    "type": "trend",
    "unit": "",
    "color": "#e74c3c",
    "format": "fixed0",
    "thresholds": {"warning": 100, "critical": 200}  # ‚Üê –ü–æ—Ä–æ–≥–∏
}
```

### –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é
```python
"custom_metric": {
    "section": "–ú–æ—è –Ω–æ–≤–∞—è —Å–µ–∫—Ü–∏—è",  # ‚Üê –ù–æ–≤–∞—è —Å–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    "label": "–ú–æ—è –º–µ—Ç—Ä–∏–∫–∞",
    "promql": "my_metric",
    "type": "trend",
    "unit": "—à—Ç",
    "color": "#3498db",
    "format": "fixed0"
}
```

---

**–í—ã–≤–æ–¥**: –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ **10 —Ä–∞–∑ –ø—Ä–æ—â–µ** –∏ **–≤ 10 —Ä–∞–∑ –Ω–∞–¥–µ–∂–Ω–µ–µ**! üéâ 